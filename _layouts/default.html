---
layout: compress
---

{% include base_path %}

<!doctype html>
<html lang="{{ site.locale | slice: 0,2 }}" class="no-js"{% if site.site_theme == "dark" %} data-theme="dark"{% endif %}>
  <head>
    {% include head.html %}
    {% include head/custom.html %}
    <!-- 引入 Mermaid -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  </head>

  <body>

    {% include browser-upgrade.html %}
    {% include masthead.html %}

    {{ content }}

    <div class="page__footer">
      <footer>
        {% include footer/custom.html %}
        {% include footer.html %}
      </footer>
    </div>

    {% include scripts.html %}

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // 1. 初始化 Mermaid
        mermaid.initialize({
            startOnLoad: false,
            theme: 'default',  // 可改成 dark / forest / neutral
            securityLevel: 'loose'
        });

        // 2. 遍历所有 Mermaid 代码块
        document.querySelectorAll('pre > code.language-mermaid').forEach(codeBlock => {
            const pre = codeBlock.closest('pre');

            // 创建渲染容器
            const container = document.createElement('div');
            container.classList.add('mermaid');
            container.textContent = codeBlock.innerText; // 保证 Mermaid 解析正确

            // 替换 <pre> 为 <div>
            pre.parentNode.replaceChild(container, pre);

            // 3. 手动渲染
            const uniqueId = 'mermaid-' + Math.random().toString(36).substr(2, 9);
            try {
                mermaid.mermaidAPI.render(uniqueId, container.textContent, svgCode => {
                    container.innerHTML = svgCode;
                });
            } catch (err) {
                console.error('Mermaid render error:', err, container.textContent);
            }
        });
    });
    </script>

  </body>
</html>
